<?php
//TODO 专业版
class Comm_Weibo_Data
{
    // 获取企业影响力
    const ENTERPRISE_INFLUENCE_URL = "http://data.i.t.sina.com.cn/enterprisev2/getinfluence.php?uid=%s";
    // 博文统计
    const ENTERPRISE_STATUS_ANALYSIS_URL = 'http://data.i.t.sina.com.cn/enterprisev2/getweibostatistics.php?uid=%s';
    const ENTERPRISE_STATUS_ANALYSIS_URL_V2 = 'http://data.i.t.sina.com.cn/enterprisev2/getweibostatisticsv2.php?uid=%s&sdate=%s&edate=%s';

    // 均值统计
    const ENTERPRISE_AVERAGE_URL = 'http://data.i.t.sina.com.cn/enterprisev2/getaverage.php?gid=%s';

    // 粉丝趋势
    const ENTERPRISE_FANSTREND_URL = 'http://data.i.t.sina.com.cn/enterprisev2/getfanstrend.php?uid=%s&days=%s';
    const ENTERPRISE_FANSTREND_URL_V2 = 'http://data.i.t.sina.com.cn/enterprisev2/getfanstrendv2.php?uid=%s&sdate=%s&edate=%s';

    // 企业博文内容分析
    const ENTERPRISE_CONTENT_ANALYSIS_URL = 'http://data.i.t.sina.com.cn/enterprisev2/getweibocontent.php?uid=%s';

    // Top10转发评论曝光
    const ENTERPRISE_TOP10_URL = "http://data.i.t.sina.com.cn/enterprisev2/getweibotop10.php?uid=%s";

    // 企业行为统计
    const ENTERPRISE_ACTIONTRENDS_URL = "http://data.i.t.sina.com.cn/enterprisev2/getbehavior.php?uid=%s";
    const ENTERPRISE_ACTIONTRENDS_URL_V2 = "http://data.i.t.sina.com.cn/enterprisev2/getbehaviorv2.php?uid=%s&sdate=%s&edate=%s";

    // 短链分析
    const ENTERPRISE_SHORTURL = "http://data.i.t.sina.com.cn/enterprisev2/getshorturltop50.php?uid=%s";

    // 粉丝比率
    const ENTERPRISE_FANSRATIO = 'http://data.i.t.sina.com.cn/enterprisev2/getfansratio.php?uid=%s';
    const ENTERPRISE_FANSRATIO_V2 = 'http://data.i.t.sina.com.cn/enterprisev2/getfansratiov2.php?uid=%s&sdate=%s&edate=%s';

    // 粉丝性别分布以及认证用户
    const ENTERPRISE_FANS_GENDER = 'http://data.i.t.sina.com.cn/enterprisev2/getfansgender.php?uid=%s';

    // 活跃忠诚粉丝TOP20
    const ENTERPRISE_FANS_TOP20 = 'http://data.i.t.sina.com.cn/enterprisev2/getfansquality.php?uid=%s&flag=1';
    // 粉丝年龄分布
    const ENTERPRISE_FANS_AGE_DISTRIBUTION = 'http://data.i.t.sina.com.cn/enterprisev2/getfansage.php?uid=%s';
    // 粉丝标签
    const ENTERPRISE_FANS_TAG = 'http://data.i.t.sina.com.cn/enterprisev2/getfanstag.php?uid=%s';
    // 粉丝地区分布
    const ENTERPRISE_FANS_AREA = 'http://data.i.t.sina.com.cn/enterprisev2/getfansarea.php?uid=%s';
    // PV ，UV
    const ENTERPRISE_PAGEVIEW = 'http://data.i.t.sina.com.cn/enterprisev2/getflow.php?uid=%s';
    const ENTERPRISE_PAGEVIEW_V2 = 'http://data.i.t.sina.com.cn/enterprisev2/getflowv2.php?uid=%s&sdate=%s&edate=%s';

    // 访客分析
    const ENTERPRISE_VISITOR = 'http://data.i.t.sina.com.cn/enterprisev2/getvisitors.php?uid=%s';
    const ENTERPRISE_VISITOR_V2 = 'http://data.i.t.sina.com.cn/enterprisev2/getvisitorsv2.php?uid=%s&sdate=%s&edate=%s';

    // 访客性别分析
    const ENTERPRISE_VISITOR_SEX = 'http://data.i.t.sina.com.cn/enterprisev2/getvisitorsgender.php?uid=%s';
    // 访客年龄分布
    const ENTERPRISE_VISITOR_AGE = 'http://data.i.t.sina.com.cn/enterprisev2/getvisitorsage.php?uid=%s';
    // 访客地域分布
    const ENTERPRISE_VISITOR_AREA = 'http://data.i.t.sina.com.cn/enterprisev2/getvisitorsarea.php?uid=%s';

    // 企业粉丝习惯24小时活跃时段
    const ENTERPRISE_FANSHABIT_24HOURS_URL = "http://data.i.t.sina.com.cn/enterprisev2/get24hourdis.php?uid=%s&flag=%s";

    // 企业粉丝习惯周活跃时段
    const ENTERPRISE_FANSHABIT_WEEKS_URL = "http://data.i.t.sina.com.cn/enterprisev2/getweekdis.php?uid=%s&flag=%s";

    // 企业粉丝习惯客户端使用比例分析
    const ENTERPRISE_FANSHABIT_CLIENT_USE_URL = "http://data.i.t.sina.com.cn/enterprisev2/getlogintypeV2.php?uid=%s";

    // 企业粉丝习惯客户端使用比例分析
    const ENTERPRISE_EXPOSURE = "http://data.i.t.sina.com.cn/enterprisev2/getexposure.php?uid=%s";

    // 企业应用分析--获取企业安装应用在某段时间内的PUV
    const ENTERPRISE_APP_PUV = "http://data.i.t.sina.com.cn/enterprisev2/getapppvuv.php?uid=%s&daycount=%s";
    // 企业应用分析--获取企业安装应用在某段时间内的互动次数，互动人数
    const ENTERPRISE_APP_INTERACT = "http://data.i.t.sina.com.cn/enterprisev2/getappinteract.php?uid=%s&daycount=%s";
    const ENTERPRISE_APP_INTERACT_V2 = "http://data.i.t.sina.com.cn/enterprisev2/getappinteractv2.php?uid=%s&daycount=%s&sdate=%s&edate=%s";
    // 企业应用分析--获取企业安装的某个应用在某段时间内的详细数据
    const ENTERPRISE_APP_DETAIL = "http://data.i.t.sina.com.cn/enterprisev2/getappinteractdetail.php?uid=%s&appkey=%s&daycount=%s";
    const ENTERPRISE_APP_DETAIL_V2 = "http://data.i.t.sina.com.cn/enterprisev2/getappinteractdetailv2.php?uid=%s&appkey=%s&daycount=%s&sdate=%s&edate=%s";
    // 企业应用分析--获取企业安装的应用近30天的PVUV数
    const ENTERPRISE_APP_PUV_TREND = "http://data.i.t.sina.com.cn/enterprisev2/getapppvuvtrend.php?uid=%s&appkey=%s";
    const ENTERPRISE_APP_PUV_TREND_V2 = "http://data.i.t.sina.com.cn/enterprisev2/getapppvuvtrendv2.php?uid=%s&appkey=%s&sdate=%s&edate=%s";

    // 获取企业基本信息
    const GET_ENTERPRISE_INFO = "http://i.verified.weibo.com/verify/apply/get?uid=%s&appid=%d&cip=%s&appkey=%s";
    // 单条博文分析
    const SINGLE_MBLOG_ANALYSE = "http://data.i.t.sina.com.cn/enterprisev2/getweibodetail.php?uid=%s&sortfield=%s&pagesize=%s&pagenum=%s&sorttype=%s";
    // 短链分析
    const SORTURL_ANALYSE = "http://data.i.t.sina.com.cn/enterprisev2/getshorturlnew.php?uid=%s&pagesize=%s&pagenum=%s";
    // 来源分析
    const SOURCE_ANALYSE = "http://data.i.t.sina.com.cn/enterprisev2/getflowsrc.php?uid=%s&sortfield=%s&pagesize=%s&pagenum=%s&sorttype=%s&type=%s&sdate=%s&edate=%s";
    // 粉丝的微龄
    const FANS_WEIBO_AGE = "http://data.i.t.sina.com.cn/enterprisev2/getfanstblogage.php?uid=%s";
    // 成为粉丝的时长
    const AS_FANS_TIMES = "http://data.i.t.sina.com.cn/enterprisev2/getfanstime.php?uid=%s";
    // 粉丝分组
    const FANS_GROUP = "http://user.opendata.sina.com.cn/interface/intf/get_enterprise_fans_group.jsp?uid=%s&age=%s&sex=%s&area=%s&fanstime=%s&fansage=%s&pagenum=%s&prepage=%s&pagesize=%s&startrow=%s";
    // 粉丝的粉丝
    const ENTERPRISE_FANS_FANS = "http://data.i.t.sina.com.cn/microdata/getfanscount.php?uid=%s";
    // 套餐数据
    const ENTERPRISE_PACKAGE_DATA = "http://data.i.t.sina.com.cn/enterprisev2/getservicepackage.php?uid=%s&sdate=%s&edate=%s";

    // 昨日互动数 用户发布博文收到的评论数，转发数，收到的私信数，被@数
    const ENTERPRISE_YESTERDAY_INTERACTIVE_DATA = "http://data.i.t.sina.com.cn/enterprisev2/getinteractfans.php?uid=%s";
    // 上周净增粉丝数,上周净增粉丝数具体排名,上周净增粉丝数排名百分比-上上周排名百分比,上周曝光量,上周曝光量具体排名,上周曝光量排名百分比-上上周排名百分比,上周互动数,上周互动数具体排名,上周互动数排名百分比-上上周排名百分比
    const ENTERPRISE_LASTWEEK_DATA = "http://data.i.t.sina.com.cn/enterprisev2/getnewfansexposureweek.php?uid=%s";
    // 同类排名统计，净增粉丝数，博文曝光量，互动数
    const ENTERPRISE_SIMILAR_RANK_DATA = "http://data.i.t.sina.com.cn/enterprisev2/getindustryweek.php?uid=%s";
    // 同类排名No.1和增长最快统计，净增粉丝数，博文曝光量，互动数
    const ENTERPRISE_SIMILAR_RANK_TOP_DATA = "http://data.i.t.sina.com.cn/enterprisev2/getindustrytopweek.php?uid=%s";
    /**
     * 获取GET请求的响应内容
     *
     * @param $url string
     * @param $isRawUrl BOOL
     *            是否直接使用原始url，此参数解决GET参数传递数组的情况，如id[]=xxx&id[]=yyy
     * @return mixed
     */
    public static function getResponseResult($url, $isRawUrl = FALSE)
    {
        $request = new Comm_HttpRequest();
        if ($isRawUrl === FALSE)
        {
            $request->setUrl($url);
        }
        else
        {
            $request->url = $url;
        }
        $request->send();
        return $request->getResponseContent();
    }

    /**
     * 获取POST请求的响应内容
     *
     * @param unknown_type $url
     * @param unknown_type $postdata
     * @param unknown_type $is_raw_url
     */
    public static function fetchPostResponseResult($url, $postdata, $isRawUrl = FALSE)
    {
        $request = new Comm_HttpRequest();
        $request->setMethod('POST');
        if (is_array($postdata))
        {
            foreach ($postdata as $key => $value)
            {
                $request->addPostField($key, $value);
            }
        }
        if ($isRawUrl === FALSE)
        {
            $request->setUrl($url);
        }
        else
        {
            $request->url = $url;
        }

        $request->send();
        return $request->getResponseContent();
    }

    /**
     * 获取企业影响力
     *
     * @param $uid int
     *            企业UID
     * @param $monthly bool
     *            是否返回一个月的数据
     */
    public static function getEnterpriseInfluence($uid, $monthly = FALSE)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }

        $url = sprintf(self::ENTERPRISE_INFLUENCE_URL, $uid);
        $result =  Comm_HttpRequest::getResult($url, TRUE);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 博文统计
     *
     * @param $uid int
     * @throws Comm_Exception_Program
     */
    public static function getEnterpriseStatusAnalysis($uid, $sdate, $edate)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_STATUS_ANALYSIS_URL_V2, $uid, $sdate, $edate);
        $result = Comm_HttpRequest::getResult($url, TRUE);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 均值统计
     */
    public static function getAverage($category, $ext = NULL)
    {
        $url = sprintf(self::ENTERPRISE_AVERAGE_URL, $category);

        $result = Comm_HttpRequest::getResult($url);
        return $result ['result'];
    }

    /**
     * 获取30天内的粉丝趋势
     *
     * @param $uid unknown_type
     */
    public static function getFansTrend($uid, $sdate, $edate)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANSTREND_URL_V2, $uid, $sdate, $edate);
        $result = Comm_HttpRequest::getResult($url);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 微博内容分析
     *
     * @param $uid unknown_type
     * @throws Comm_Exception_Program
     */
    public static function getWeiboContent($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_CONTENT_ANALYSIS_URL, $uid);
        $result = Comm_HttpRequest::getResult($url);

        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * Top10转发，评论，曝光
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseTop10($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_TOP10_URL, $uid);
        $result = Comm_HttpRequest::getResult($url);

        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 企业行为统计（原创微博，转发，评论，私信）
     *
     * @param $uid unknown_type
     * @throws Comm_Exception_Program
     */
    public static function getEnterpriseActiontrends($uid, $sdate, $edate)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_ACTIONTRENDS_URL_V2, $uid, $sdate, $edate);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 企业短链分析
     *
     * @param $uid unknown_type
     * @throws Comm_Exception_Program
     */
    public static function getEnterpriseShorturl($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_SHORTURL, $uid);
        $result = Comm_HttpRequest::getResult($url);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取粉丝比率
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseFansratio($uid, $sdate = '', $edate = '')
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANSRATIO_V2, $uid, $sdate, $edate);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取粉丝性别分布以及粉丝中的V认证用户，达人用户量
     */
    public static function getEnterpriseFansgender($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANS_GENDER, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取活跃粉丝，忠诚粉丝TOP20
     */
    public static function getEnterpriseTop20Fans($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANS_TOP20, $uid);
        $result = self::getResponseResult($url);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取粉丝年龄分布
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseFansAgeDistribution($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANS_AGE_DISTRIBUTION, $uid);

        $result = Comm_HttpRequest::getResult($url);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . json_encode($result));
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取粉丝标签
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseFansTag($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANS_TAG, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 粉丝地区分布
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseFansArea($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANS_AREA, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * PV，UV，在线时长统计
     *
     * @param $uid unknown_type
     */
    public static function getEnterprisePageview($uid, $sdate, $edate)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_PAGEVIEW_V2, $uid, $sdate, $edate);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 访客成分
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseVisitor($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_VISITOR, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 访客性别
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseVisitorSex($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_VISITOR_SEX, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 访客年龄分布
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseVisitorAge($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_VISITOR_AGE, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 访客地域分布
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseVisitorArea($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_VISITOR_AREA, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 企业粉丝习惯 -- 24小时分布统计（每小时在线数，发博数）
     *
     * @param $uid unknown_type
     * @param $type string
     *            online(在线数 默认)，pub(发博数)
     * @throws Comm_Exception_Program
     */
    public static function getEnterpriseFanshabit24hours($uid, $type = 'online')
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANSHABIT_24HOURS_URL, $uid, $type);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);

            return array();
        }
        return $result ['result'];
    }

    /**
     * 企业粉丝习惯 -- 一周分布统计（每小时在线数，发博数）
     *
     * @param $uid unknown_type
     * @param $type string
     *            login(登录数 默认)、pub(发博数)
     * @throws Comm_Exception_Program
     */
    public static function getEnterpriseFanshabitWeeks($uid, $type = 'login')
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANSHABIT_WEEKS_URL, $uid, $type);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 企业粉丝习惯 -- 客户端使用情况统计
     *
     * @param $uid unknown_type
     * @throws Comm_Exception_Program
     */
    public static function getEnterpriseFanshabitClient($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANSHABIT_CLIENT_USE_URL, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取企业分类
     */
    public static function getEnterpriseClass()
    {
        $cip = Comm_Context::getServer("REMOTE_ADDR");
        $url = Comm_Weibo_Api_Request_Idott::assembleUrl("", "admin", "getVuserClass", $cip);
        $idott = new Comm_Weibo_Api_Request_Idott($url, "GET");
        $idott->addRule("depart", "int", true);
        $idott->addRule("uid", "string", true);
        return $idott;
    }

    /**
     * 获取企业基本信息
     */
    public static function getEnterpriseInfo($uid)
    {
        $cip = Comm_Context::getServer("REMOTE_ADDR");
        // onst GET_ENTERPRISE_INFO = "http://i.verified.weibo.com/verify/apply/get?uid=%s&appid=%d&cip=%s&appkey=%s";
        $appid = Comm_Config::get('env.idott_api_appid');
        $appkey = Comm_Config::get('env.platform_api_source');
        $url = sprintf(self::GET_ENTERPRISE_INFO, $uid, $appid, $cip, $appkey);
        $postdata = array(
            'uid' => $uid
        );
        $response = self::fetchPostResponseResult($url, $postdata);
        if ($response === null)
        {
            return false;
        }
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取企业曝光率
     */
    public static function getEnterpriseExposure($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_EXPOSURE, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取企业安装应用在某段时间内的PUV
     *
     * @param $uid unknown_type
     * @param $dimession unknown_type
     */
    public static function getEpsApplicationPuv($uid, $dimession)
    {
        if (!is_numeric($uid) || !is_numeric($dimession))
        {
            throw new Comm_Exception_Program('argument $uid or $dimession must be  numeric');
        }
        $url = sprintf(self::ENTERPRISE_APP_PUV, $uid, $dimession);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        // result =
        // array('errno'=>1,'errmsg'=>'succ','code'=>'B00001','result'=>array('1495616373'=>array('pv'=>123424,'uv'=>23432)));
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取企业安装应用在某段时间内的互动人数，互动次数
     *
     * @param $uid unknown_type
     * @param $dimession unknown_type
     */
    public static function getEpsApplicationInteract($uid, $dimession)
    {
        if (!is_numeric($uid) || !is_numeric($dimession))
        {
            throw new Comm_Exception_Program('argument $uid or $dimession must be  numeric');
        }
        $url = sprintf(self::ENTERPRISE_APP_INTERACT, $uid, $dimession);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        // result =
        // array('errno'=>1,'errmsg'=>'succ','code'=>'B00001','result'=>array('1495616373'=>array('interact_count'=>123424,'interact_people'=>23432)));
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取企业安装的某个应用在某个时间内的各指标详情
     *
     * @param $uid int
     * @param $appkey int
     * @param $dimession int
     */
    public static function getEpsAppstatisticDetail($uid, $appkey, $dimession)
    {
        if (!is_numeric($uid) || !is_numeric($appkey) || !is_numeric($dimession))
        {
            throw new Comm_Exception_Program('argument $uid or $dimession must be  numeric');
        }
        $url = sprintf(self::ENTERPRISE_APP_DETAIL, $uid, $appkey, $dimession);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        // result =
        // array('errno'=>1,'errmsg'=>'succ','code'=>'B00001','result'=>array('0'=>array('name'=>'share','interact_count'=>'12312312','interact_people'=>'23423')));
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取企业安装的所以应用近30天内的PUV数
     *
     * @param $uid int
     * @throws Comm_Exception_Program
     */
    public static function getEpsAppPuvTrend($uid, $appkey, $sdate, $edate)
    {
        if (empty($uid) || empty($appkey))
        {
            throw new Comm_Exception_Program('argument $uid  must be  numeric');
        }
        $url = sprintf(self::ENTERPRISE_APP_PUV_TREND_V2, $uid, $appkey, $sdate, $edate);
        $response = self::getResponseResult($url, true);
        $result = json_decode($response, true);
        // result =
        // array('errno'=>1,'errmsg'=>'succ','code'=>'B00001','result'=>array('2012-03-21'=>array('pv'=>22,'uv'=>'32'),'2012-03-20'=>array('pv'=>22,'uv'=>'32'),'2012-03-20'=>array('pv'=>22,'uv'=>'32'),'2012-03-19'=>array('pv'=>22,'uv'=>'32'),'2012-03-18'=>array('pv'=>22,'uv'=>'32')));
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取单条博文分析
     *
     * @param int64 $uid
     * @param string $sortfield
     *            排序的字段 time（发布时间）、exposure （曝光量）、forward（被转发）、comment（被评论）、click（被点击）
     * @param int $pagesize
     *            页数
     * @param int $pagenum
     *            每页大小
     * @param int $sorttype
     *            升序 1、降序 2
     * @throws Comm_Exception_Program
     */
    public static function getSingleMblogAnalyse($uid, $sortfield = 'forward', $pagesize = 10, $pagenum = 1, $sorttype = 1)
    {
        if (empty($uid))
        {
            throw new Comm_Exception_Program('argument $uid  must be  numeric');
        }
        $url = sprintf(self::SINGLE_MBLOG_ANALYSE, $uid, $sortfield, $pagesize, $pagenum, $sorttype);
        $response = self::getResponseResult($url, true);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取短链分析分析
     *
     * @param int64 $uid
     * @param int $pagesize
     *            页数
     * @param int $pagenum
     *            每页大小
     * @throws Comm_Exception_Program
     */
    public static function getShorturlAnalyse($uid, $pagesize = 10, $pagenum = 1)
    {
        if (empty($uid))
        {
            throw new Comm_Exception_Program('argument $uid  must be  numeric');
        }
        $url = sprintf(self::SORTURL_ANALYSE, $uid, $pagesize, $pagenum);
        $response = self::getResponseResult($url, true);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 来源分析
     *
     * @param int64 $uid
     * @param string $sortfield
     *            排序的字段 pv（PV）、uv （UV）、newviewers（新访客数）
     * @param int $pagesize
     *            页数
     * @param int $pagenum
     *            每页大小
     * @param int $sorttype
     *            升序 1、降序 2
     * @throws Comm_Exception_Program
     */
    public static function getSourceAnalyse($uid, $sortfield = 'pv', $type = 30, $sdate = '', $edate = '', $pagesize = 20, $pagenum = 1, $sorttype = 1)
    {
        if (empty($uid))
        {
            throw new Comm_Exception_Program('argument $uid  must be  numeric');
        }
        $url = sprintf(self::SOURCE_ANALYSE, $uid, $sortfield, $pagesize, $pagenum, $sorttype, $type, $sdate, $edate);
        $response = self::getResponseResult($url, true);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取粉丝的微龄
     *
     * @param $uid unknown_type
     */
    public static function getFansWeiboAge($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::FANS_WEIBO_AGE, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 获取成为您粉丝的时长
     *
     * @param $uid unknownType
     */
    public static function getAsFansTimes($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::AS_FANS_TIMES, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }

    /**
     * 粉丝分组
     *
     * @param $uid unknown_type
     */
    public static function getFansGroup($uid, $age = 0, $sex = 0, $area = 0, $fanstime = 0, $fansage = 0, $pagenum = 1, $prepage = 0, $pagesize = 20, $startrow = 0)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::FANS_GROUP, $uid, $age, $sex, $area, $fanstime, $fansage, $pagenum, $prepage, $pagesize, $startrow);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if (!empty($result ['errList']))
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['rs'] [0];
    }

    /**
     * 粉丝的粉丝
     *
     * @param $uid unknown_type
     */
    public static function getEnterpriseFansFans($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_FANS_FANS, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }
    /**
     * 获取套餐数据
     *
     * @param $uid unknown_type
     */
    public static function getEnterprisePackagedata($uid, $sdate, $edate)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_PACKAGE_DATA, $uid, $sdate, $edate);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }
    /**
     * 获取昨日互动数据
     *
     * @param $uid unknown_type
     */
    public static function getInteractFans($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_YESTERDAY_INTERACTIVE_DATA, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }
    /**
     * 获取上周净增粉丝数，博文曝光量，互动数等统计
     *
     * @param $uid unknown_type
     */
    public static function getNewfansExposureWeek($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_LASTWEEK_DATA, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }
    /**
     * 同类排名统计，净增粉丝数，博文曝光量，互动数
     *
     * @param $uid unknown_type
     */
    public static function getIndustryWeek($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_SIMILAR_RANK_DATA, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }
    /**
     * 同类排名No.1和增长最快统计，净增粉丝数，博文曝光量，互动数
     *
     * @param $uid unknown_type
     */
    public static function getIndustryTopWeek($uid)
    {
        if (empty($uid) || !is_numeric($uid))
        {
            throw new Comm_Exception_Program('argument $uid must be not empty and is numeric');
        }
        $url = sprintf(self::ENTERPRISE_SIMILAR_RANK_TOP_DATA, $uid);
        $response = self::getResponseResult($url);
        $result = json_decode($response, true);
        if ($result ['errno'] != 1)
        {
            Tool_Log::error("API_DATA_ERROR" . $url . '|' . $response);
            return array();
        }
        return $result ['result'];
    }
}
